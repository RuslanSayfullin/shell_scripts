#!/bin/bash

# docron -- запускает те ежедневные, еженедельные и ежемесячные системные
# задания cron, которые, скорее всего, не могли быть выполнены из-за
# выключения системы в часы, на которые эти задания
# запланированы.

rootcron="/etc/crontab" # Этот путь может значительно отличаться в разных
                        # версиях Unix и Linux.

if [ "$(id -u)" -ne 0 ] ; then
    # Здесь также можно использовать $(whoami) != "root".
    echo "$0: Command must be run as 'root'" >&2
    exit 1
fi

# Предполагается, что в системном файле cron имеются записи с метками
# 'daily', 'weekly' и 'monthly' (ежедневно, еженедельно и ежемесячно).
# Если заданий с такими метками нет, это ошибка. Но в случае, если
# такие задания имеются (что соответствует нашим ожиданиям), попытаемся
# сначала получить команду.

job="$(awk "NF > 6 && /$1/ { for (i=7;i<=NF;i++) print \$i }" $rootcron)"

if [ -z "$job" ] ; then # Нет задания? Странно. Ладно, это ошибка.
    echo "$0: Error: no $1 job found in $rootcron" >&2
    exit 1
fi

SHELL=$(which sh) # Для соответствия с умолчаниями в cron

eval $job
# Сценарий завершится вместе с заданием. 



